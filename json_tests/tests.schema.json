{
    "$schema": "https://json-schema.org/draft-07/schema#",
    "properties": {
        "cases": {
            "type": "array",
            "items": {
                "$ref": "#/definitions/testCase"
            }
        }
    },
    "definitions": {
        "testCase": {
            "properties": {
                "name": {
                    "type": "string"
                },
                "url": {
                    "type": "string"
                },
                "ignore": {
                    "type": "string",
                    "description": "A reason why this test case should be ignored. If set, the test will not be run."
                }
            },
            "oneOf": [
                {
                    "$ref": "#/definitions/mainPhase"
                },
                {
                    "$ref": "#/definitions/retreatPhase"
                },
                {
                    "$ref": "#/definitions/buildPhase"
                }
            ],
            "required": ["name", "url"]
        },
        "mainPhase": {
            "properties": {
                "edition": {
                    "$ref": "#/definitions/edition"
                },
                "phase": {
                    "enum": ["Main"]
                },
                "starting_state": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/unitPosition"
                    }
                },
                "orders": {
                    "type": "object",
                    "patternProperties": {
                        "^[A-Z]{3}: [AF] .+$": {
                            "enum": ["Succeeds", "Fails", null]
                        }
                    }
                }
            },
            "required": ["phase", "orders"]
        },
        "retreatPhase": {
            "properties": {
                "edition": {
                    "enum": ["1971", "1982", "2023"]
                },
                "phase": {
                    "enum": ["Retreat"]
                },
                "preceding_main_phase": {
                    "properties": {
                        "starting_state": {
                            "type": "array",
                            "items": {
                                "$ref": "#/definitions/unitPosition"
                            }
                        },
                        "orders": {
                            "type": "object",
                            "patternProperties": {
                                "^[A-Z]{3}: [AF] .+$": {
                                    "enum": ["Succeeds", "Fails", null]
                                }
                            }
                        }
                    },
                    "required": ["orders"]
                },
                "orders": {
                    "type": "object",
                    "patternProperties": {
                        "^[A-Z]{3}: [AF] .+$": {
                            "enum": ["Succeeds", "Fails", null]
                        }
                    }
                }
            },
            "required": ["phase", "preceding_main_phase", "orders"]
        },
        "buildPhase": {
            "properties": {
                "edition": {
                    "$ref": "#/definitions/edition"
                },
                "phase": {
                    "enum": ["Build"]
                },
                "civil_disorder": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/unitPosition"
                    },
                    "description": "A list of units that are expected to disband in civil disorder."
                },
                "occupiers": {
                    "type": "object",
                    "patternProperties": {
                        "^[a-z]{3}$": {
                            "pattern": "^[A-Z]{3}$"
                        }
                    },
                    "description": "A map of provinces to the nations that occupy them."
                },
                "starting_state": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/unitPosition"
                    }
                },
                "orders": {
                    "type": "object",
                    "patternProperties": {
                        "^[A-Z]{3}: [AF] .+$": {
                            "type": ["string", "null"]
                        }
                    }
                }
            },
            "required": ["phase", "orders"]
        },
        "edition": {
            "enum": ["1971", "1982", "2023", "dptg"],
            "description": "The edition of the rules that this test case is based on. If not set, the test should work on any edition of the standard rules."
        },
        "unitPosition": {
            "type": "string",
            "pattern": "^[A-Z]{3}: [AF] [a-z()]+$"
        }
    }
}
